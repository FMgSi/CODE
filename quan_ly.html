<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Trang Qu·∫£n Tr·ªã</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background-color: #f4f6f9; 
            padding: 20px; 
            text-align: center; 
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0px 4px 10px rgba(0,0,0,0.1); 
            display: inline-block; 
            width: 80%; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 12px; 
            text-align: left; 
        }
        th { 
            background-color: #007bff; /* Ti√™u ƒë·ªÅ b·∫£ng m√†u xanh */
            color: white; 
        }
        .btn-logout { 
            padding: 10px 20px; 
            background-color: #dc3545; /* N√∫t ƒë·ªè */
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin-top: 20px; 
        }
        .btn-logout:hover { background-color: #c82333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè† TRANG QU·∫¢N TR·ªä S·∫¢N PH·∫®M</h1>
        <div style="background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: left;">
            <input type="text" id="tu_khoa" placeholder="Nh·∫≠p t√™n SP c·∫ßn t√¨m..." style="padding: 8px; width: 200px;">
            <button onclick="timKiem()" style="padding: 8px 12px; background: #17a2b8; color: white; border: none; cursor: pointer;">üîç T√¨m ki·∫øm</button>
            
            <span style="margin: 0 10px;">|</span>
            
            <button onclick="sapXep('tang')" style="padding: 8px; cursor: pointer;">‚¨ÜÔ∏è Gi√° tƒÉng</button>
            <button onclick="sapXep('giam')" style="padding: 8px; cursor: pointer;">‚¨áÔ∏è Gi√° gi·∫£m</button>

            <button onclick="doiGiaoDien()" style="float: right; padding: 8px; background: #343a40; color: white; border: none; border-radius: 5px; cursor: pointer;">üåô Ch·∫ø ƒë·ªô t·ªëi</button>
        </div>
        <p>Ch√†o m·ª´ng S·∫øp! D∆∞·ªõi ƒë√¢y l√† kho h√†ng c·ªßa ch√∫ng ta:</p>
        <div style="background: #e2e8f0; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: left;">
            <h3 style="margin-top: 0;">‚ûï Nh·∫≠p S·∫£n Ph·∫©m M·ªõi</h3>
            <input type="text" id="nhap_ma" placeholder="M√£ SP (VD: DT05)" style="padding: 8px; width: 120px;">
            <input type="text" id="nhap_ten" placeholder="T√™n h√†ng" style="padding: 8px; width: 150px;">
            <input type="text" id="nhap_mau" placeholder="M√†u s·∫Øc" style="padding: 8px; width: 100px;">
            <input type="number" id="nhap_gia" placeholder="Gi√° ti·ªÅn" style="padding: 8px; width: 120px;">
            
            <select id="nhap_loai" style="padding: 8px;">
                <option value="DienThoai">ƒêi·ªán Tho·∫°i</option>
                <option value="Laptop">Laptop</option>
            </select>
            
            <button onclick="themSanPham()" style="padding: 9px 15px; background: #28a745; color: white; border: none; cursor: pointer; border-radius: 4px;">Th√™m Ngay</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>M√£ SP</th>
                    <th>T√™n H√†ng</th>
                    <th>M√†u S·∫Øc</th>
                    <th>Gi√° Ti·ªÅn</th>
                    <th>Lo·∫°i</th>
                    <th>H√†nh ƒê·ªông</th> </tr>
            </thead>
            <tbody id="bang_san_pham">
                <tr>
                    <td colspan="5" style="text-align: center; color: #888;">
                        ‚è≥ ƒêang t·∫£i d·ªØ li·ªáu t·ª´ MySQL... (Ch√∫ng ta s·∫Ω l√†m ·ªü b√†i sau)
                    </td>
                </tr>
            </tbody>
        </table>

        <button class="btn-logout" onclick="dangXuat()">ƒêƒÉng Xu·∫•t</button>
    </div>

    <script>
        function dangXuat() {
            window.location.href = "dang_nhap.html";
        }

        // H√ÄM N√ÄY S·∫º T·ª∞ ƒê·ªòNG CH·∫†Y NGAY KHI V·ª™A M·ªû TRANG WEB L√äN
        window.onload = function() {
            // 1. G·ªçi ƒëi·ªán ƒë·∫øn ƒë∆∞·ªùng ·ªëng l·∫•y s·∫£n ph·∫©m
            fetch("http://localhost:8080/api/sanpham")
                .then(response => response.json()) // Bi·∫øn c·ª•c h√†ng g·ª≠i v·ªÅ th√†nh m·∫£ng JS
                .then(danhSach => {
                    // T√¨m c√°i b·∫£ng c√≥ ID l√† bang_san_pham
                    let bang = document.getElementById("bang_san_pham");
                    
                    // X√≥a tr·∫Øng c√°i d√≤ng "ƒêang t·∫£i d·ªØ li·ªáu..." ƒëi
                    bang.innerHTML = ""; 

                    // 2. D√πng v√≤ng l·∫∑p, m·ªói s·∫£n ph·∫©m t·∫°o ra 1 d√≤ng HTML (<tr>)
                    // Th√™m 1 c·ªôt ch·ª©a n√∫t X√≥a m√†u ƒë·ªè v√†o cu·ªëi m·ªói d√≤ng
                    danhSach.forEach(sp => {
                        let dongMoi = `
                            <tr>
                                <td>${sp.maSP}</td>
                                <td><b>${sp.tenHang}</b></td>
                                <td>${sp.mauSac}</td>
                                <td style="color: red; font-weight: bold;">
                                    ${sp.giaTien.toLocaleString('vi-VN')} VNƒê
                                </td>
                                <td>${sp.loai}</td>
                                <td>
                                    <button onclick="suaGia('${sp.maSP}', ${sp.giaTien})" style="background-color: #ffc107; color: black; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin-right: 5px;">S·ª≠a Gi√°</button>
                                    
                                    <button onclick="xoaSanPham('${sp.maSP}')" style="background-color: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">X√≥a</button>
                                </td>
                            </tr>
                        `;
                        bang.innerHTML += dongMoi;
                    });
                })
                .catch(error => {
                    console.log("L·ªói: ", error);
                    document.getElementById("bang_san_pham").innerHTML = 
                        "<tr><td colspan='5' style='color:red;'>‚ö†Ô∏è L·ªói m·∫•t k·∫øt n·ªëi v·ªõi Java Server!</td></tr>";
                });
        }

        function themSanPham() {
            // L·∫•y ch·ªØ ng∆∞·ªùi d√πng v·ª´a g√µ
            let ma = document.getElementById("nhap_ma").value;
            let ten = document.getElementById("nhap_ten").value;
            let mau = document.getElementById("nhap_mau").value;
            let gia = document.getElementById("nhap_gia").value;
            let loai = document.getElementById("nhap_loai").value;

            // Ki·ªÉm tra xem c√≥ ƒë·ªÉ tr·ªëng √¥ n√†o kh√¥ng
            if (!ma || !ten || !mau || !gia) {
                alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!");
                return;
            }

            // G√≥i h√†ng l·∫°i. D√πng encodeURIComponent ƒë·ªÉ x·ª≠ l√Ω c√°c d·∫•u c√°ch trong t√™n (V√≠ d·ª•: "iPhone 15" -> "iPhone%2015")
            let url = "http://localhost:8080/api/them?ma=" + ma + 
                      "&ten=" + encodeURIComponent(ten) + 
                      "&mau=" + encodeURIComponent(mau) + 
                      "&gia=" + gia + "&loai=" + loai;

            // G·ªçi shipper (fetch) mang l√™n cho Java
            fetch(url)
                .then(res => res.text())
                .then(ketQua => {
                    if (ketQua === "OK") {
                        alert("üéâ ƒê√£ th√™m s·∫£n ph·∫©m th√†nh c√¥ng v√†o MySQL!");
                        location.reload(); // √âp trang web t·ª± ƒë·ªông F5 t·∫£i l·∫°i ƒë·ªÉ hi·ªán h√†ng m·ªõi
                    } else {
                        alert("‚ùå C√≥ l·ªói x·∫£y ra, c√≥ th·ªÉ tr√πng M√£ SP!");
                    }
                });
        }

        function xoaSanPham(maSP) {
            // H·ªèi l·∫°i cho ch·∫Øc ƒÉn (tr√°nh b·∫•m nh·∫ßm)
            let xacNhan = confirm("‚ö†Ô∏è S·∫øp c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m " + maSP + " kh√¥ng?");
            if (!xacNhan) return; // N·∫øu b·∫•m Cancel th√¨ th√¥i kh√¥ng l√†m g√¨ c·∫£

            // G·ªçi shipper mang m√£ SP ƒëi x√≥a
            fetch("http://localhost:8080/api/xoa?ma=" + maSP)
                .then(res => res.text())
                .then(ketQua => {
                    if (ketQua === "OK") {
                        alert("üóëÔ∏è ƒê√£ x√≥a th√†nh c√¥ng!");
                        location.reload(); // T·ª± ƒë·ªông F5 l·∫°i b·∫£ng
                    } else {
                        alert("‚ùå C√≥ l·ªói x·∫£y ra, kh√¥ng th·ªÉ x√≥a!");
                    }
                });
        }

        function suaGia(maSP, giaCu) {
            // L·ªánh prompt s·∫Ω b·∫≠t ra 1 √¥ cho ng∆∞·ªùi d√πng g√µ ch·ªØ, hi·ªÉn th·ªã s·∫µn gi√° c≈©
            let giaMoi = prompt("Nh·∫≠p GI√Å M·ªöI cho s·∫£n ph·∫©m " + maSP + ":", giaCu);

            // N·∫øu ng∆∞·ªùi d√πng b·∫•m H·ªßy (Cancel) ho·∫∑c x√≥a tr·∫Øng
            if (giaMoi === null || giaMoi.trim() === "") {
                return; 
            }

            // Ki·ªÉm tra xem c√≥ g√µ linh tinh ch·ªØ c√°i v√†o kh√¥ng
            if (isNaN(giaMoi) || parseInt(giaMoi) <= 0) {
                alert("‚ö†Ô∏è Gi√° ti·ªÅn ph·∫£i l√† m·ªôt con s·ªë h·ª£p l·ªá!");
                return;
            }

            // G·ªçi shipper mang Gi√° M·ªõi l√™n ƒë∆∞a cho Java
            fetch("http://localhost:8080/api/sua?ma=" + maSP + "&gia=" + giaMoi)
                .then(res => res.text())
                .then(ketQua => {
                    if (ketQua === "OK") {
                        alert("‚úÖ ƒê√£ c·∫≠p nh·∫≠t gi√° m·ªõi th√†nh c√¥ng!");
                        location.reload(); // √âp F5 t·∫£i l·∫°i trang
                    } else {
                        alert("‚ùå C√≥ l·ªói x·∫£y ra, kh√¥ng th·ªÉ s·ª≠a gi√°!");
                    }
                });
        }

        // --- H√ÄM V·∫º B·∫¢NG D√ôNG CHUNG ---
        // B·∫•t c·ª© khi n√†o nh·∫≠n ƒë∆∞·ª£c danh s√°ch (t·ª´ t·∫£i trang, t√¨m ki·∫øm, s·∫Øp x·∫øp), c·ª© n√©m v√†o ƒë√¢y l√† n√≥ v·∫Ω l·∫°i b·∫£ng
        function veLaiBang(danhSach) {
            let bang = document.getElementById("bang_san_pham");
            bang.innerHTML = ""; 
            if (danhSach.length === 0) {
                bang.innerHTML = "<tr><td colspan='6'>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o!</td></tr>";
                return;
            }
            danhSach.forEach(sp => {
                bang.innerHTML += `
                    <tr>
                        <td>${sp.maSP}</td>
                        <td><b>${sp.tenHang}</b></td>
                        <td>${sp.mauSac}</td>
                        <td style="color: red; font-weight: bold;">${sp.giaTien.toLocaleString('vi-VN')} VNƒê</td>
                        <td>${sp.loai}</td>
                        <td>
                            <button onclick="suaGia('${sp.maSP}', ${sp.giaTien})" style="background-color: #ffc107; border: none; padding: 5px; cursor: pointer;">S·ª≠a</button>
                            <button onclick="xoaSanPham('${sp.maSP}')" style="background-color: #dc3545; color: white; border: none; padding: 5px; cursor: pointer;">X√≥a</button>
                        </td>
                    </tr>
                `;
            });
        }

        // --- C√ÅC CH·ª®C NƒÇNG M·ªöI ---
        function timKiem() {
            let tk = document.getElementById("tu_khoa").value;
            fetch("http://localhost:8080/api/timkiem?tuKhoa=" + encodeURIComponent(tk))
                .then(res => res.json())
                .then(danhSach => veLaiBang(danhSach)); // G·ªçi h√†m v·∫Ω b·∫£ng
        }

        function sapXep(kieu) {
            fetch("http://localhost:8080/api/sapxep?kieu=" + kieu)
                .then(res => res.json())
                .then(danhSach => veLaiBang(danhSach));
        }

        function doiGiaoDien() {
            // Thay ƒë·ªïi m√†u n·ªÅn c·ªßa body (Giao di·ªán t·ªëi)
            document.body.style.backgroundColor = document.body.style.backgroundColor === "rgb(34, 34, 34)" ? "#f4f6f9" : "#222";
        }
    </script>
</body>
</html>